<template name="initiativeHomepage">

  <div id="modal1" class="modal" style="width: 95%;">
    <div class="modal-content">
    {{!---------------------- Tabs --------------------}}
    <div class="row">
      <div class="col s12">
        <ul class="tabs">
          <li class="tab col s2"> <a class="active" href="#initiative">Initiative</a> </li>
          {{#if isInRole "admin"}}
          <li class="tab col s2 {{isTabDisabled 1}}"> <a href="#lineItem1">Line Item 1</a> </li>
          <li class="tab col s2 {{isTabDisabled 2}}"> <a href="#lineItem2">Line Item 2</a> </li>
          <li class="tab col s2 {{isTabDisabled 3}}"> <a href="#lineItem3">Line Item 3</a> </li>
          <li class="tab col s2 {{isTabDisabled 4}}"> <a href="#lineItem4">Line Item 4</a> </li>
          <li class="tab col s2 {{isTabDisabled 5}}"> <a href="#lineItem5">Line Item 5</a> </li>
          <li class="tab col s2 {{isTabDisabled 6}}"> <a href="#lineItem6">Line Item 6</a> </li>
          <li class="tab col s2 {{isTabDisabled 7}}"> <a href="#lineItem7">Line Item 7</a> </li>
          <li class="tab col s2 {{isTabDisabled 8}}"> <a href="#lineItem8">Line Item 8</a> </li>
          {{/if}}
        </ul>
      </div>
    </div>
    {{!------------- divs for each tab  ----------------}}
    <div id="initiative">
        <div class="row dashboard-initiative-header">
          <div class="col s3">
            <p class="center-align border-bottom">Name</p>
            <h4 class="center-align no-top-margin">{{initiative.name}}</h4>
          </div>
          <div class="col s3">
            <p class="center-align border-bottom">Agency</p>
            <h4 class="center-align no-top-margin">{{initiative.agency}}</h4>
          </div>
          <div class="col s3">
          <p class="center-align border-bottom">Brand</p>
            <h4 class="center-align no-top-margin">{{initiative.brand}}</h4>
          </div>
          <div class="col s3">
          <p class="center-align border-bottom">Product</p>
            <h4 class="center-align no-top-margin">{{initiative.product}}</h4>
          </div>
        </div>
        <h5>Line Items</h5>
        <table class="centered">
          {{#each initiative.lineItems}}
          <thead>
            <tr>
              {{#if objective}} <th>Objective</th> {{/if}}
              {{#if platform}} <th>Platform</th> {{/if}}
              {{#if dealType}} <th>Deal Type</th> {{/if}}
              {{#if quantity}} <th>Quantity</th> {{/if}}
              {{#if price}} <th>Price</th> {{/if}}
              {{#if budget}} <th>Budget</th> {{/if}}
              {{#if startDate}} <th>Start Date</th> {{/if}}
              {{#if endDate}} <th>End Date</th> {{/if}}
              {{#if costPlusPercent}} <th>Cost Plus</th> {{/if}}
              {{#if percentTotalPercent}} <th>Percent Total</th> {{/if}}
              {{#if isClientPercent}} <th>Client</th> {{/if}}
            </tr>
          </thead>
          <tbody>
            <tr>
              {{#if objective}}<td>{{objective}}</td>{{/if}}
              {{#if platform}}<td>{{platform}}</td>{{/if}}
              {{#if dealType}}<td>{{dealType}}</td>{{/if}}
              {{#if quantity}}<td>{{quantity}}</td>{{/if}}
              {{#if price}}<td>{{price}}</td>{{/if}}
              {{#if budget}}<td>{{budget}}</td>{{/if}}
              {{#if startDate}}<td>{{formatDate startDate}}</td>{{/if}}
              {{#if endDate}}<td>{{formatDate endDate}}</td>{{/if}}
              {{#if costPlusPercent}}<td>{{costPlusPercent}}%</td>{{/if}}
              {{#if percentTotalPercent}}<td>{{percentTotalPercent}}%</td>{{/if}}
              {{#if isClientPercent}}<td>{{isClientPercent}}%</td>{{/if}}
            </tr>
          </tbody>
          {{/each}}
        </table>
        <br>
        <div class="col s10">
          {{#with initiativeStats}}
          <h5>Gross Aggregate | Client Numbers</h5>
          <table class="centered">
            <thead>
              <tr>
                <th class="insights-table-header">Spend</th>
                <th class="insights-table-header">Spend %</th>
                <th class="insights-table-header">Clicks</th>
                <th class="insights-table-header">CPC</th>
                <th class="insights-table-header">Impressions</th>
                <th class="insights-table-header">CPM</th>
                <th class="insights-table-header">Likes</th>
                <th class="insights-table-header">CPL</th>
                <th class="insights-table-header">Reach</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="insights-table-data">{{spend}}</td>
                <td class="insights-table-data">{{spendPercent}}</td>
                <td class="insights-table-data">{{clicks}}</td>
                <td class="insights-table-data">{{cpc}}</td>
                <td class="insights-table-data">{{impressions}}</td>
                <td class="insights-table-data">{{cpm}}</td>
                <td class="insights-table-data">{{likes}}</td>
                <td class="insights-table-data">{{cpl}}</td>
                <td class="insights-table-data">{{reach}}</td>
              </tr>
            </tbody>
          </table>
          {{/with}}


          {{#each objectiveAggregates}}
            <h5>Aggregate for Objective {{_id}}</h5>
            <table class="centered">
              <thead>
                <tr>
                  <th class="insights-table-header">Spend</th>
                  <th class="insights-table-header">Clicks</th>
                  <th class="insights-table-header">CPC</th>
                  <th class="insights-table-header">Impressions</th>
                  <th class="insights-table-header">CPM</th>
                  <th class="insights-table-header">Likes</th>
                  <th class="insights-table-header">CPL</th>
                  <th class="insights-table-header">Video Views</th>
                  <th class="insights-table-header">CPVV</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="insights-table-data">{{spend}}</td>
                  <td class="insights-table-data">{{clicks}}</td>
                  <td class="insights-table-data">{{cpc}}</td>
                  <td class="insights-table-data">{{impressions}}</td>
                  <td class="insights-table-data">{{cpm}}</td>
                  <td class="insights-table-data">{{likes}}</td>
                  <td class="insights-table-data">{{cpl}}</td>
                  <td class="insights-table-data">{{videoViews}}</td>
                  <td class="insights-table-data">{{cpvv}}</td>
                </tr>
              </tbody>
            </table>
          {{/each}}
        </div>
      </div>
    </div>
{{!-- TODO here --> create template for each initiative, maybe down the line
include charting for each lineItem and definitely aggregations --}}
  {{#if isInRole "admin"}}
    {{#each initiative.lineItems}}
      {{!-- starts with Line Item 1 --}}
      <div id="lineItem{{addOne @index}}">
        <table class="centered">
          {{#with grabLineItem @index}}
            <thead>
              <tr>
                {{#if objective}} <th>Objective</th> {{/if}}
                {{#if platform}} <th>Platform</th> {{/if}}
                {{#if dealType}} <th>Deal Type</th> {{/if}}
                {{#if quantity}} <th>Quantity</th> {{/if}}
                {{#if price}} <th>Price</th> {{/if}}
                {{#if budget}} <th>Budget</th> {{/if}}
                {{#if startDate}} <th>Start Date</th> {{/if}}
                {{#if endDate}} <th>End Date</th> {{/if}}
                {{#if costPlusPercent}} <th>Cost Plus</th> {{/if}}
                {{#if percentTotalPercent}} <th>Percent Total</th> {{/if}}
                {{#if isClientPercent}} <th>Client</th> {{/if}}
              </tr>
            </thead>
            <tbody>
              <tr>
                {{#if objective}}<td>{{objective}}</td>{{/if}}
                {{#if platform}}<td>{{platform}}</td>{{/if}}
                {{#if dealType}}<td>{{dealType}}</td>{{/if}}
                {{#if quantity}}<td>{{quantity}}</td>{{/if}}
                {{#if price}}<td>{{formatMoney price}}</td>{{/if}}
                {{#if budget}}<td>{{formatMoney budget}}</td>{{/if}}
                {{#if startDate}}<td>{{formatDate startDate}}</td>{{/if}}
                {{#if endDate}}<td>{{formatDate endDate}}</td>{{/if}}
                {{#if costPlusPercent}}<td>{{costPlusPercent}}%</td>{{/if}}
                {{#if percentTotalPercent}}<td>{{percentTotalPercent}}%</td>{{/if}}
                {{#if isClientPercent}}<td>{{isClientPercent}}%</td>{{/if}}
              </tr>
            </tbody>
          {{/with}}
        </table>
        <h5>Net Aggregate | Targeted Social Numbers</h5>
        {{!-- {{#with netCostPlusStats @index}} --}}
        {{#with calcNet @index}}
          <table class="centered">
            <thead>
              <tr>
                <th class="insights-table-header">Net Budget</th>
                <th class="insights-table-header">Net Spend</th>
                <th class="insights-table-header">Net Spend Percent</th>
                <th class="insights-table-header">Net CPC</th>
                <th class="insights-table-header">Net CPM</th>
                <th class="insights-table-header">Net CPL</th>
                <th class="insights-table-header">Net CPVV</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="insights-table-data">{{formatMoney net_budget}}</td>
                <td class="insights-table-data">{{formatMoney net_spend}}</td>
                <td class="insights-table-data">{{formatPercent net_spendPercent}}</td>
                <td class="insights-table-data">{{formatMoney net_cpc}}</td>
                <td class="insights-table-data">{{formatMoney net_cpm}}</td>
                <td class="insights-table-data">{{formatMoney net_cpl}}</td>
                <td class="insights-table-data">{{formatMoney net_cpvv}}</td>
              </tr>
            </tbody>
          </table>
        {{/with}}
      </div>
    {{/each}}
  {{/if}}
  </div>

  {{!--------------------- End of modal1 Initiative Stats ---------------------}}




  {{!------------------ Beginning of modal2 aggregate stats -------------------}}

  <div id="modal2" class="modal" style="width: 95%;">
    <div class="modal-content">
      {{!-- <div class="row">
        <div class="col s12">
          {{#with initiativeStats}}
            <h5>Gross Aggregate | Client Numbers</h5>
            <table class="centered">
              <thead>
                <tr>
                  <th class="insights-table-header">Spend</th>
                  <th class="insights-table-header">Spend %</th>
                  <th class="insights-table-header">Clicks</th>
                  <th class="insights-table-header">CPC</th>
                  <th class="insights-table-header">Impressions</th>
                  <th class="insights-table-header">CPM</th>
                  <th class="insights-table-header">Likes</th>
                  <th class="insights-table-header">CPL</th>
                  <th class="insights-table-header">Reach</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="insights-table-data">{{spend}}</td>
                  <td class="insights-table-data">{{spendPercent}}</td>
                  <td class="insights-table-data">{{clicks}}</td>
                  <td class="insights-table-data">{{cpc}}</td>
                  <td class="insights-table-data">{{impressions}}</td>
                  <td class="insights-table-data">{{cpm}}</td>
                  <td class="insights-table-data">{{likes}}</td>
                  <td class="insights-table-data">{{cpl}}</td>
                  <td class="insights-table-data">{{reach}}</td>
                </tr>
              </tbody>
            </table>
          {{/with}}
        </div>
      </div> --}}
      <div class="row">
        <div class="col s12">
          <form action="#" id="campaignAggregateForm">
            <div class="col s6">
              <h3>Choose Campaigns to Aggregate</h3>
              {{#each campaign in getCampaigns}}
                <p>
                  <input type="checkbox" name="aggregate" id="{{campaign.data.campaign_id}}"/>
                  <label for="{{campaign.data.campaign_id}}" style="font-size: 1.7em;">{{campaign.data.name}}</label>
                </p>
              {{/each}}
            </div>
            <div class="col s6">
              <h3>Choose Line Item</h3>
              <select name="lineItemSelect" id="aggregator-line-item-select" class="browser-default">
                <option value="" disabled selected>Choose Line Item</option>
                {{#each line in initiativeLineItems}}
                  <option value="{{line.name}}">{{line.name}}: {{line.platform}} - {{line.dealType}}</option>
                {{/each}}
              </select>
            </div>
            <div class="col s12 center-align">
              <input type="submit" value="Aggregate Chosen Campaigns" class="btn waves-effect waves-light" style="margin-top: 2em;">
            </div>
          </form>
        </div>
      </div>
      <div class="row">
        <div class="col s12">
          {{> highchartsHelper chartId="aggregateDeliveryChart" chartWidth="100%" chartHeight="100%" chartObject=aggregateDeliveryChart}}
        </div>
        <div class="col s12">
          {{> highchartsHelper chartId="aggregateCostPerChart" chartWidth="100%" chartHeight="100%" chartObject=aggregateCostPerChart}}
        </div>
      </div>
    </div>
  </div>

{{#if isReady "Initiatives" "campaignInsightList" "insightsBreakdownByDaysList"}}
  <div class="container">
    <div class="row">
      <div class="row dashboard-initiative-header">
        <div class="col s3">
          <p class="center-align border-bottom">Name</p>
          <h4 class="center-align no-top-margin">{{initiative.name}}</h4>
        </div>
        <div class="col s3">
          <p class="center-align border-bottom">Agency</p>
          <h4 class="center-align no-top-margin">{{initiative.agency}}</h4>
        </div>
        <div class="col s3">
        <p class="center-align border-bottom">Brand</p>
          <h4 class="center-align no-top-margin">{{initiative.brand}}</h4>
        </div>
        <div class="col s3">
        <p class="center-align border-bottom">Product</p>
          <h4 class="center-align no-top-margin">{{initiative.product}}</h4>
        </div>
      </div>
      <h5 class="center-align">Line Items</h5>
      <table class="centered">
        {{#each initiative.lineItems}}
        <thead>
          <tr>
            {{#if objective}} <th>Objective</th> {{/if}}
            {{#if platform}} <th>Platform</th> {{/if}}
            {{#if dealType}} <th>Deal Type</th> {{/if}}
            {{#if quantity}} <th>Quantity</th> {{/if}}
            {{#if price}} <th>Price</th> {{/if}}
            {{#if budget}} <th>Budget</th> {{/if}}
            {{#if startDate}} <th>Start Date</th> {{/if}}
            {{#if endDate}} <th>End Date</th> {{/if}}
            {{#if costPlusPercent}} <th>Cost Plus</th> {{/if}}
            {{#if percentTotalPercent}} <th>Percent Total</th> {{/if}}
            {{#if isClientPercent}} <th>Client</th> {{/if}}
          </tr>
        </thead>
        <tbody>
          <tr>
            {{#if objective}}<td>{{objective}}</td>{{/if}}
            {{#if platform}}<td>{{platform}}</td>{{/if}}
            {{#if dealType}}<td>{{dealType}}</td>{{/if}}
            {{#if quantity}}<td>{{formatNumber quantity}}</td>{{/if}}
            {{#if price}}<td>{{formatMoney price}}</td>{{/if}}
            {{#if budget}}<td>{{formatMoney budget}}</td>{{/if}}
            {{#if startDate}}<td>{{formatDate startDate}}</td>{{/if}}
            {{#if endDate}}<td>{{formatDate endDate}}</td>{{/if}}
            {{#if costPlusPercent}}<td>{{costPlusPercent}}%</td>{{/if}}
            {{#if percentTotalPercent}}<td>{{percentTotalPercent}}%</td>{{/if}}
            {{#if isClientPercent}}<td>{{isClientPercent}}%</td>{{/if}}
          </tr>
        </tbody>
        {{/each}}
      </table>
    </div>
    {{!-- task tracker --}}
    {{#if isInRole "admin"}}
      {{> Template.dynamic template=tasks}}
    {{/if}}
    <br><br>
    <div class="row">
      <h3 class="center-align">Changelog</h3>
      <form class="changelog col s12">
        <div class="input-field col s7">
          <input type="text" id="change-tracker-input" name="name" placeholder="Input changes to initiative or campaign. Date will be automatically added.">
        </div>
        <div class="input-field col s3">
          <select name="changelog_campaigns" id="changelog-select" class="browser-default">
            <option value="" disabled selected>Select Campaign if Applicable</option>
            <option value="Initiative Level Change">Initiative Level Change</option>
            {{#each changelogCampaigns}}
              <option value="{{this}}">{{this}}</option>
            {{/each}}
          </select>
          <label class="active">Tag a Campaign</label>
        </div>
        <div class="col s2">
          <button class="btn waves-effect waves-light" type="submit" name="action" style="top: 1em;">
            Submit Change
          </button>
        </div>
      </form>
    </div>
    <div class="row">
      <div class="col s12">
        {{#each changelog}}
          <div class="row">
            <div class="col s2">
              <p>{{formatDate date}}</p>
            </div>
            <div class="col s6">
              <p>{{change}}</p>
            </div>
            <div class="col s3">
              <p>{{campaignTag}}</p>
            </div>
            <div class="col s1">
              <a href="" data-id="{{id}}" class="delete-change">delete</a>
            </div>
          </div>
        {{else}}
          <p>Changelog is empty.</p>
        {{/each}}
      </div>
    </div>
  </div>

{{!--     {{#each initiative.lineItems}}
    <div class="row">
      <div class="col s12">
        {{> highchartsHelper chartId="lineItemDelivery" chartWidth="100%" chartHeight="75%" chartObject=lineItemDelivery number=(lineItemDelivery @index)}}
      </div>
    </div>
    {{/each}} --}}
  <div class="row" style="width: 90%;">
    {{#if initiative.lineItems.[0].budget}}
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveChart0" chartWidth="90%" chartHeight="70%" chartObject=objectiveChart0}}
      </div>
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveCostPerChart0" chartWidth="90%" chartHeight="70%" chartObject=objectiveCostPerChart0}}
      </div>
    {{/if}}
    {{#if initiative.lineItems.[1].budget}}
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveChart1" chartWidth="90%" chartHeight="70%" chartObject=objectiveChart1}}
      </div>
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveCostPerChart1" chartWidth="90%" chartHeight="70%" chartObject=objectiveCostPerChart1}}
      </div>
    {{/if}}
    {{#if initiative.lineItems.[2].budget}}
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveChart2" chartWidth="90%" chartHeight="70%" chartObject=objectiveChart2}}
      </div>
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveCostPerChart2" chartWidth="90%" chartHeight="70%" chartObject=objectiveCostPerChart2}}
      </div>
    {{/if}}
    {{#if initiative.lineItems.[3].budget}}
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveChart3" chartWidth="90%" chartHeight="70%" chartObject=objectiveChart3}}
      </div>
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveCostPerChart3" chartWidth="90%" chartHeight="70%" chartObject=objectiveCostPerChart3}}
      </div>
    {{/if}}
    {{#if initiative.lineItems.[4].budget}}
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveChart4" chartWidth="90%" chartHeight="70%" chartObject=objectiveChart4}}
      </div>
      <div class="col s6">
        {{> highchartsHelper chartId="objectiveCostPerChart4" chartWidth="90%" chartHeight="70%" chartObject=objectiveCostPerChart4}}
      </div>
    {{/if}}
  </div>

  {{!--  List of campaigns within the initiative  --}}
  <div class="container">
    <div class="row">
      {{#each getCampaigns}}
        <div class="col s12 m12 l12">
          <div class="card">
            <!-- used to be "card z-depth 2" for the class -->
            <div class="card-content">
              <a href="/accounts/{{data.campaign_id}}/overview"><span class="card-title">{{data.name}}</span></a>
              <p>{{data.start_time}} - {{data.stop_time}}</p>
              <p>Objective: {{data.objective}}</p>
            </div>
          </div>
        </div>
      {{/each}}
    </div>
  </div>
{{else}}
  <p>
    Loading....
  </p>
{{/if}}

</template>

